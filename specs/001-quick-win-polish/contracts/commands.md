# Command Contracts: Quick Win Polish

**Feature**: 001-quick-win-polish
**Date**: 2026-02-07

## New Commands

### `focusSpace.addAllOpenEditors`

**Title**: "Focus Space: Add All Open Editors"
**When**: Always available (command palette)
**Icon**: `$(files)` (optional, for menus)
**Input**: None
**Behavior**:
1. Enumerate all tabs via `vscode.window.tabGroups.all`
2. Filter to `TabInputText` with `uri.scheme === 'file'`
3. Deduplicate by URI string
4. For each URI: check `manager.hasEntry(uri)` → skip if present
5. For each URI: check `configuration.isExcluded(uri.fsPath)` → skip if excluded
6. For each new URI: `manager.addEntry(uri, type)`
7. Show info message: "Added N files to Focus Space. M already present, K excluded."

**Edge cases**:
- 0 open tabs → "No open editor files found."
- All tabs already in Focus Space → "All N open editors are already in Focus Space."
- Mixed → report added/skipped/excluded counts

---

### `focusSpace.sendToCopilot`

**Title**: "Focus Space: Send to Copilot Chat"
**When**: `focusSpace.hasItems`
**Icon**: `$(comment-discussion)`
**Context menu**: Focus Space tree view (on files, sections, and root)
**Input**: Optional `treeItem` — if provided, scope to that item/section; otherwise, all files
**Behavior**:
1. Resolve target entries (single file, section children, or all files via `TreeOperations.flatten`)
2. Show progress via `withProgress(ProgressLocation.Notification, cancellable: true)`
3. For each file entry:
   a. Check existence via `workspace.fs.stat()` → skip missing, increment `skippedMissing`
   b. Read content via `workspace.fs.readFile()`
   c. Check binary (null byte in first 512 bytes) → skip, increment `skippedBinary`
   d. Check file size > 1MB → skip
   e. Estimate tokens (`content.length / 4`)
   f. If cumulative tokens > budget → stop, record `excludedCount`
   g. Truncate individual file if > 50,000 chars
4. Build formatted markdown context
5. Copy to clipboard via `vscode.env.clipboard.writeText()`
6. Attempt `vscode.commands.executeCommand('workbench.action.chat.open')` (best-effort)
7. Show info message with summary (files included, excluded, budget used)

**Replaces**: `focusSpace.testCopilotCommands`, `focusSpace.testWorkspaceFile`, `focusSpace.testClipboard`

---

### `focusSpace.addFromGitChanges`

**Title**: "Focus Space: Add from Git Changes"
**When**: Always available (command palette)
**Icon**: `$(git-compare)`
**Input**: None
**Behavior**:
1. Get Git extension via `vscode.extensions.getExtension('vscode.git')`
2. If not found → show info: "Git extension not available."
3. Activate if needed, get API v1
4. If no repositories → show info: "No Git repository found in this workspace."
5. Get repository matching current workspace folder (or first repo)
6. Collect URIs from `state.workingTreeChanges` + `state.indexChanges` + `state.mergeChanges`
7. Deduplicate by URI string
8. Filter out: already in Focus Space, matching exclude patterns, deleted files (status === DELETED)
9. Add remaining via `manager.addEntry(uri, 'file')`
10. Show info message: "Added N files from Git changes. M already present, K excluded."

**Edge cases**:
- No changes → "No changed files found in the current Git repository."
- Detached HEAD → still works (compares working tree)

---

### `focusSpace.revealView`

**Title**: "Focus Space: Show Panel"
**When**: Always (internal use, status bar click)
**Input**: None
**Behavior**: Execute `focusSpace.focusSpace.focus` (the tree view focus command auto-generated by VS Code for view ID `focusSpace`)

---

## Removed Commands

| Command | Reason |
|---------|--------|
| `focusSpace.testCopilotCommands` | Replaced by `focusSpace.sendToCopilot` |
| `focusSpace.testWorkspaceFile` | Replaced by `focusSpace.sendToCopilot` |
| `focusSpace.testClipboard` | Replaced by `focusSpace.sendToCopilot` |

---

## Modified Menus

### `view/item/context` (Focus Space tree)

Add:
```json
{
  "command": "focusSpace.sendToCopilot",
  "when": "view == focusSpace",
  "group": "copilot"
}
```

Remove the three test command menu entries.

### `view/title` (Focus Space panel header)

Add:
```json
{
  "command": "focusSpace.sendToCopilot",
  "when": "view == focusSpace",
  "group": "navigation"
}
```

---

## New Settings

### `focusSpace.copilotTokenBudget`

| Property | Value |
|----------|-------|
| Type | `number` |
| Default | `60000` |
| Minimum | `1000` |
| Maximum | `200000` |
| Description | "Maximum estimated token count for Copilot context export. Files are included until this budget is reached." |
| Category | `Workflow` |

### `focusSpace.renameDetectionWindowMs`

| Property | Value |
|----------|-------|
| Type | `number` |
| Default | `300` |
| Minimum | `50` |
| Maximum | `2000` |
| Description | "Time window (milliseconds) to detect folder renames from correlated file system create/delete events." |
| Category | `Performance` |
